# 20190626

# Blockchain

블록체인과 거래혁명

## 새로운 세상을 상상해보자

* 우리의 식사, OO파동
* 옆의 동료를 믿을 수 있나? 나의 연구를 훔치지 않는다고?

## 블록체인이란?

* trust machine, 신뢰를 만드는 기계
* 서로 믿지 못할 일이 많다! 제 3의 기관을 통해 신뢰를 형성해 거래해왔다.ex) 은행

### 블록체인의 가치

기술의 역사: 정보의 소유와 생산(PC)->정보의 공유(인터넷)->정보의 신뢰(블록체인)

제2의 인터넷시대를 열 것

### 기술적 배경

* 거래내역을 분산, 네트워크 참가자 모두에게 내용 공개 및 기록
* 거래마다 노드 가진 사람들 블록체인 업데이트, 무결성 유지

기존 금융: 중앙 정부에서 장부 완전 관리-> 블록체인: 각자 따로 장부 가짐

* 블록체인 시스템
  * 퍼블릭 :  기업에 필요한 것이라든지 허락 된 노드만 참여 할 수 있는 블록체인
  * 프라이빗 : 누구나 참여 가능
* 핵심 기술 구성도
  * P2P네트워크 - 서로 확인 가능
  * 암호화 - 해시, 오리지날 값을 모르게 사용
  * 파일 매니저 - 블록을 계속 만들어 나가는 것
  * 합의 알고리즘 - 서로 거래를 합의
  * 스마트 컨트랙트 - 프로그램 코드를 넣을 수 있는 구조, 안의 코드를 실행 할  수 있는 기술

## 블록체인과 시장의 변화

### 암호화폐

* 문제? 그동안 화폐 발행은 국가 고유권한, 앞으로는?

### 비즈니스 도메인 활성화 코인

* 특정 도메인에서 화폐 활성화, 화폐가 도메인 활성화
  * SNS 스팀잇: sns활동을 열심히하면 코인이 나온다.
  * 파일 코인: 전세계 비어있는 스토리지가 많으니까 조금씩 내놓자. 코인 줄테니
  * IoTA: IoT 데이터 거래 화폐

### 디지털 세대들의 인식 변화

* 은행 필요성 못느껴
* 지불방식, 새로운 화폐 거부감 적어

### 디지털 금융의 미래

* 모든 것이 디지털화 될 수는 없다. 그러나 디지털화 할 수 있는 것은 모두 디지털화 될 것이다-헤르만 지몬 교수

#### 비금융권 응용 확대

* 인증/관리
  * 전자 문서, 권한, 디지털 신분증
* 자산거래
  * 부동산 거래, 귀금속 거래 등
* 기타

#### IoT 기술 제어를 위한 고신뢰 서비스 기술

* slock it
  * 사물인터넷과 스마트 컨트랙트
  * 도어락에 직접 페이, 에어 bnb 필요 없다
* 농수산물 저장창고 상태확인 coldchain 서비스
  * 지난 시간 온도가 일정 하다는 것을 증명하게 하라
  * 트럭기사의 모럴해저드, 냉장비가 더 커
* 딥마인드 헬스
  * 의료정보의 고신뢰 기술
  * 정보 수집과정에 블록체인 기술
  * 입증가능한 데이터 검사
  * 데이터가 언제, 어떤 목적으로 사용 됐는지에 대한 기록을 블록체인 상에 저장

### 사회적 변화

미래 인프라사회

#### 블록체인과 공유경제 사회

* 협업 소비, 신뢰의 문제 많아
* 발전에너지 교환 거래 신뢰 등

#### 블록체인에 뛰어드는 대기업의 5가지 유형

* 뒤집기 한판: 코닥
  * 사진 저작권 정보 저장 및 사진 거래 플랫폼
  * 스마트 계약, 코인 통한 거래
* 판을 한 번 흔들어 보려고: 도요타
  * 블록체인 차량 공유 플랫폼
  * 개인간 스마트 계약을 통한 차량 공유 거래 가능
* 판을 통째 삼키려고: 월마트
  * 블록체인 이용 농축산 유통과정 저장
  * QR코드 스캔 통한 이력 조회
* 군살을 빼려고: 에어버스
  * 스마트 계약으로 각국 협력
  * 원산지 확인, 설계도 유출 방지 등
  * 3D프린팅 부품 생산과 이동과정 저장 및 관리
* 블록체인 자체에 위협을 느껴서: 도쿄전력
  * 블록체인 이용 에너지 거래 플랫폼
  * 개인간 태양광 에너지 거래 가능

### 신플랫폼 시대의 개막

기존에 못이겼다. 이번엔 이겨야...

#### Real world vs digital world

* 디지털은 원래 현실 보조 이제는 역방향
* 디지털 역량 갖춘 기업이 32% 더 성장, 27% 더 마진
* borders가 아마존 위협으로 파산
* blockbuster가 넷플릭스 위협으로 파산

#### 디지털 세상 특징

* 분할, 병합 간단
* 시공간 초월
* 자동화

#### Digital transformation of real world assets

현실 자산의 디지털 변화

### 블록체인 기반 '디지털 거래소'구출 발표

스위스 최대 증권 거래서 SIX가 블록체인 기반 디지털 거래소 설립 발표

## 이더리움

### 이더리움 소개

#### 이더리움이란?

* 비탈릭 부테린이 제안한 공개형 블록체인
* 중요한 결정 분산 결정 되어야 한다고 생각해서 개발
* 분산 어플리케이션 위한 플랫폼 표방
* 블록체인 2.0
* 분산화된 상태 전이 머신
  * 트랜잭션에 기반한 상태 전이
  * 알호화 알고리즘 활용->무작위 상태 전이 방지
  * 모든 참여자 동일 상태 공유
  * 해당 시점의 이더리움 상태를 나타낸다.

#### 이더리움의 구성요소

* 이더리움 계정의 종류
  * 외부소유 계정
    * 잔액유지, 개인키 통한 주소관리, 전송, 컨트랜트 실행 위한 거래 전송 가능
    * 컨트랙트 코드 없음
  * 컨트랙트 계정
    * 잔액 유지, 주소 있으나 개인키 없음, 컨트랙트 코드 보유
    * 거래나 메시지를 수신하면 보유하고 있는 컨트랙트 코드 실행
* 주소생성
  * 개인키 생성:256bit 무작위 숫자->64자리 Hex값으로 인코딩
  * 타원곡선전자서명 알고리즘 사용 공개키 생성
  * Keccak-256 hashing
  * 계정 주소
* 상태
  * 어느 한 시점의 장액, 정보를 담은 계정 집합
  * 모든 이더리움의 참여 노드는 로컬에 상태 정보 유지
* 이더리움의 상태 전이(state transition)
  * 거래, 내역 추가 등
* 트랜잭션 종류
  * 트랜잭션
    * EOA가 다른 EOA,CA에 보내는 서명된 메시지
    * 잔액 변경, 컨트랜트 코드 실행
    * 계정의 상태 변화를 유도하는 트리거
  * 내부 트랜잭션
    * CA가 다른 CA혹은 EOA에 전달하는 서명되지 않은 메시지
    * 주로 컨트랙트 함수 호출에 사용
    * 블록체인에 별도로 저장되지 않음
* 트랜잭션 구조
  * 외부 트랜잭션 수, 수수료, 지불할 최대 가스양, 거래의 수신처, 거래하고자 하는 코인 양, 메시지, 함수 호출 등, 서명 정보
* 트랜잭션 리시트
  * 실행 결과 기록
  * 검색 위한 인덱스, 해당 트랜젝션이 포함된 블록의 번호 및 해시 등 저장
* 블록
  * 장부 기록 데이터 기본 단위
  * 트랜잭션의 집합
  * 주요데이터:이전 블록 헤더 해시값, 이 블록의 엉클블록, 채굴한 Mine 주소, MPT의 root값 등
* 엉클 블록
  * 메인체인에 연결되지 못한 블록, 생성 빠를수록 발생 확률 높아, 트랜잭션 처리 지연 발생, 코인 준다
* 작업 증명
  * PoW의 문제점 개선
  * ASIC 저항성 높임
  * 계산은 어렵게 검증은 쉽게
* 지분증명
  * 검증자가 가진 지분에 비례한 확률로 블록 생성 권한을 획득하고 생산된 블록을 워하는 체인에 연결, 보상 획득
  * PoW 문제점 개선-전력소모, 채굴 중앙화 등
  * 이더리움의 casper통해 PoS전환중
* Casper FFG
  * PoW+PoS하이브리드 방식
  * 1~99는 PoW, 100번째는 PoS방식 채굴, 체크 포인트라고 정의
  * 전체 PoS 점증자들중 2/3이상이 투표한 블록이며 되돌릴 수 없음
* 스마트 컨트랙트
  * solidity : 현재 가장 많이 사용되고 있는 이더리움 스마트컨트랜트 언어
  * SERPENT: 초창기 이더리우므이 스마트 컨트랙트 언어
  * LLL:어셈블리 언어와 유사
* 스마트 컨트랙트의 배포
  * 배포 위해 가스 라는 수수료 지불
  * 특수 형태의 트랙잭션으 생성, 전송
* 스마트 컨트랙트의 실행
  * 실행 위해 recipient-해당 스마트 컨트랙트의 CA
  * Payload->실행하려는 함수, 매개변수
  * 실행을 위한 가스 생성 및 전공
* 가스
  * 이더리움을 움직이게 하는 기본 단위
  * 트랜잭션, 스마트 컨트랙트를 위한 수수료 최대가스x가스가격
  * 가스가격의 기본단위Gwei, 사용자가 정의 가능 클수록 트랜잭션 빠른 처리 가능
  * 스마트 컨트랙트의 경우, 가스는 함수 종류에 따라 비용 차등 부여
  * 가스 동작 방식
    * start-add-mul-sub-end 이런 방식
* 이더리움의 동작 메커니즘
  * 계정, 트랜잭션의 생성-> 서명-> 검증-> 채굴

#### 이더리움 가상 머신(EVM)

* EVM
  * 이더리움 스마트 컨트랙트를 위한 가상머신
  * 특징- 튜링 완전 머신, 스택기반 구조, 32바이트 메모리, 주소 연산, 암호화 알고리즘 등
  * 모든 동작을 수행하기 위해서는 사전에 가스 지불 필요 DoS 방지
  * EVM의 프로그램은 내부에서만 실행되고 가상 머신의 HOST환경에는 접근 불가
  * EVM간 메시지를 통해 데이터를 송수신 가능
  * 결정적 머신->항상 동일한 상태를 반환
* EVM 아키텍쳐![evm아키텍쳐](C:\Users\multicampus\TIL\2학기\block_chain\evm아키텍쳐.PNG)
* EVM Stack
  * 모든 연산 스택에서 수행
  * 피연산자, 연산의 임시값 역시 스택에 저장
  * 최대크기 256bit x 1024
* 스택기반 동작의 이해
  * 입력값->bytecode
  * 입력값의 종류 따라 다른 동작 수행
* EVM Memory
  * 컨트랙트 호출시 생성
  * 휘발성
  * 매개변수, 지병변수 등 임시저작
  * 첫 구동시 크기0
  * 메모리 증가시 가스량 지수 증가
* EVM Storage
  * key-value 저장소
  * 자신의 스토리지에만 접근 가능
* EVM 실행으 루이한 입력값-EVM code
* 주요 명령어- 기본적으로 256 비트의 크기를 가짐, call명령어 통한 evm간 메시지 송수신

#### 솔리디티

##### 솔리디티 개요

* 이더리움 스마트 컨트랙트 언어 종류
* 객체지향, 정적타입, 스택 기반
* 버전 명시 중요- 계속 업데이트 중
* 컨트랙트 이르므 정의
* 하나의 솔리디티에서 여러개 컨트랙트 연결 가능
* 접근제어, 기본은 internal
  * public-모든 함수, 컨트랜트에서 접근 가능
  * internal-컨트랙트, 상속하는 컨트랙트 내부에서만 접근 가능
  * private- 컨트랙트 내부에서만 접근 가능
  * external- 컨트랙트 내.외부에서 접근 가능하나 상속은 불가
* 함수도 똑같이 정의 가능
  * external은 EOA에서만 호출 가능
* 함수의 종류 정의 가능
  * view- 상태를 write하지 않는 함수
  * pure- 상태를 read/write하지 않는 함수
  * fallback- 함수이름, 매개변수, 반환값이 존재하지 않는 함수, 컨트랙트의 함수 호출시 해당 함수가 존재하지 않을 때 호출 됨
  * Modifier- 함수의 행위를 변경
  * Payable- 이더를 송금해야만 호출 가능한 함수
* 자료형의 종류
  * Int의 경우 8비트 단위 가능 기본 256비트인데 가스 많이 쓰인다.
* 